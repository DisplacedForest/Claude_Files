# Setup Command

## Usage
`/setup [--check] [--minimal]`

## Description
Automated developer onboarding that sets up the complete development environment, verifies configuration, and ensures readiness to contribute.

## Process Flow

1. **Environment Detection**
   - Detect OS (Mac native or Windows via WSL)
   - Check architecture (x64/ARM)
   - Identify shell (bash/zsh)
   - Configure Claude permissions

2. **Dependency Installation**
   - Install required runtime (Node.js/Python/etc)
   - Install package managers
   - Install development tools
   - Install database clients
   - Configure IDE extensions

3. **Repository Setup**
   - Clone repository
   - Install Husky for git hooks
   - Configure pre-commit checks
   - Set up linting (ESLint/Prettier)
   - Configure git settings

4. **Application Configuration**
   - Copy environment templates
   - Configure nodemon for auto-restart
   - Set up monorepo with frontend/backend
   - Configure Claude permissions
   - Initialize development settings

5. **Database Initialization**
   - Install database server
   - Create development database
   - Run migrations
   - Seed test data
   - Create test database

6. **Verification & Testing**
   - Run system checks
   - Verify all services
   - Run test suite
   - Check API endpoints
   - Validate configuration

## Setup Checklist

```markdown
# Development Environment Setup

## üñ•Ô∏è System Requirements
- [x] OS: macOS 13.0+ / Windows 10+ with WSL2
- [x] RAM: 8GB minimum (16GB recommended)
- [x] Disk: 10GB free space
- [x] CPU: 4 cores recommended
- [x] WSL2 (Windows users only)

## üõ†Ô∏è Core Dependencies
- [x] Git 2.34+
- [x] Node.js 18.0+ (via nvm)
- [x] npm 9.0+
- [x] Docker 20.0+
- [x] Docker Compose 2.0+

## üì¶ Development Tools
- [x] VS Code with extensions
- [x] GitHub CLI (gh)
- [x] PostgreSQL client (psql)
- [x] Redis client (redis-cli)
- [x] AWS CLI (if needed)

## üîß Project Setup
- [x] Repository cloned
- [x] Dependencies installed
- [x] Environment configured
- [x] Database created
- [x] Migrations run
- [x] Test data seeded

## ‚úÖ Verification
- [x] All tests passing
- [x] API server starts
- [x] Frontend builds
- [x] Can access localhost
- [x] Database connection works
```

## Claude Permissions Configuration

### Generated settings.local.json
```json
{
  "permissions": {
    "allow": [
      "Bash(mkdir:*)",
      "Bash(cp:*)",
      "Bash(ls:*)",
      "Bash(mv:*)",
      "Bash(true)",
      "Bash(cd:*)",
      "Bash(pwd)",
      "Bash(echo:*)",
      "Bash(cat:*)",
      "Bash(npm:install*)",
      "Bash(npm:test*)",
      "Bash(npm:run:lint*)",
      "Bash(npm:run:build*)",
      "Bash(git:*)",
      "Bash(gh:*)",
      "Read(*)",
      "Write(*)",
      "Edit(*)",
      "MultiEdit(*)",
      "Glob(*)",
      "Grep(*)",
      "LS(*)"
    ],
    "deny": [
      "Bash(rm:*)",
      "Bash(npm:run:dev*)",
      "Bash(npm:start*)",
      "Bash(sudo:*)",
      "Bash(chmod:777*)",
      "Bash(>:*)"
    ]
  }
}
```

## Platform-Specific Setup

### macOS Setup Script
```bash
#!/bin/bash
# Generated by /setup command

echo "üçé Setting up macOS development environment..."

# Install Homebrew
if ! command -v brew &> /dev/null; then
    echo "Installing Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

# Install dependencies
brew install git node postgresql redis docker gh

# Install global npm packages
npm install -g nodemon husky

# Install nvm for Node version management
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# Clone repository
git clone https://github.com/company/project.git
cd project

# Install project dependencies
npm install

# Set up Husky
npx husky install
npx husky add .husky/pre-commit "npm run lint && npm test"
npx husky add .husky/commit-msg "npx commitlint --edit $1"

# Set up environment
cp .env.example .env.local
echo "Please edit .env.local with your settings"

# Initialize database
createdb project_dev
npm run db:migrate
npm run db:seed

# Install VS Code extensions
code --install-extension dbaeumer.vscode-eslint
code --install-extension esbenp.prettier-vscode
code --install-extension ms-vscode.vscode-typescript-next

echo "‚úÖ Setup complete!"
```

### Windows Setup (PowerShell)
```powershell
# Generated by /setup command

Write-Host "ü™ü Setting up Windows development environment..." -ForegroundColor Green

# Install Chocolatey
if (!(Get-Command choco -ErrorAction SilentlyContinue)) {
    Set-ExecutionPolicy Bypass -Scope Process -Force
    [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
    iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
}

# Note: On Windows, Claude Code runs in WSL
Write-Host "ü™ü Detected Windows - Setup will continue in WSL..." -ForegroundColor Green

# Install dependencies in Windows
choco install git nodejs docker-desktop gh vscode -y

# Switch to WSL for remaining setup
wsl --install
wsl --set-default-version 2

Write-Host "Please complete setup inside WSL by running: /setup" -ForegroundColor Yellow

# Continue with common setup...
```

### Docker-Based Setup
```yaml
# docker-compose.dev.yml
# Generated by /setup command

version: '3.8'

services:
  app:
    build: .
    volumes:
      - .:/app
      - /app/node_modules
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
    depends_on:
      - postgres
      - redis

  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: project_dev
      POSTGRES_USER: developer
      POSTGRES_PASSWORD: localpass
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  pgadmin:
    image: dpage/pgadmin4
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@local.dev
      PGADMIN_DEFAULT_PASSWORD: admin
    ports:
      - "5050:80"

volumes:
  postgres_data:
```

## Environment Configuration

### Project Structure Configuration

### package.json (root)
```json
{
  "name": "project-monorepo",
  "scripts": {
    "dev": "nodemon",
    "install": "npm run install:backend && npm run install:frontend",
    "install:backend": "cd backend && npm install",
    "install:frontend": "cd frontend && npm install",
    "test": "npm run test:backend && npm run test:frontend",
    "test:backend": "cd backend && npm test",
    "test:frontend": "cd frontend && npm test",
    "lint": "npm run lint:backend && npm run lint:frontend",
    "lint:backend": "cd backend && npm run lint",
    "lint:frontend": "cd frontend && npm run lint",
    "prepare": "husky install"
  },
  "devDependencies": {
    "husky": "^8.0.0",
    "nodemon": "^3.0.0",
    "@commitlint/cli": "^17.0.0",
    "@commitlint/config-conventional": "^17.0.0"
  }
}
```

### nodemon.json
```json
{
  "watch": ["backend", "frontend"],
  "ext": "js,ts,json",
  "ignore": ["*.test.js", "node_modules"],
  "exec": "concurrently \"npm run dev:backend\" \"npm run dev:frontend\"",
  "env": {
    "NODE_ENV": "development"
  }
}
```

### .husky/pre-commit
```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run linting
npm run lint

# Run tests for changed files
npm test -- --findRelatedTests

# Check types
npm run typecheck
```

### .eslintrc.js
```javascript
module.exports = {
  root: true,
  extends: [
    'eslint:recommended',
    'plugin:@typescript-eslint/recommended',
    'prettier'
  ],
  parser: '@typescript-eslint/parser',
  plugins: ['@typescript-eslint'],
  rules: {
    'no-console': 'warn',
    'no-unused-vars': 'error',
    '@typescript-eslint/no-explicit-any': 'warn'
  }
};
```

## Generated .env.local
```bash
# Application
NODE_ENV=development
APP_URL=http://localhost:3000
API_URL=http://localhost:3000/api

# Database
DATABASE_URL=postgresql://developer:localpass@localhost:5432/project_dev
TEST_DATABASE_URL=postgresql://developer:localpass@localhost:5432/project_test

# Redis
REDIS_URL=redis://localhost:6379

# Authentication
JWT_SECRET=dev-secret-change-in-production
SESSION_SECRET=dev-session-secret

# External Services (with dev keys)
STRIPE_KEY=sk_test_...
SENDGRID_KEY=SG.test...
AWS_REGION=us-east-1

# Feature Flags
ENABLE_DEBUG=true
ENABLE_PROFILING=true
```

## Verification Output

```
/setup --check
```

Output:
```
üîç Checking development environment...

‚úÖ System Requirements
   OS: macOS 14.0 (Supported)
   Node: v18.17.0 (Required: 18.0+)
   npm: v9.8.1 (Required: 9.0+)
   RAM: 16GB available

‚úÖ Dependencies
   Git: 2.42.0 ‚úì
   Docker: 24.0.5 ‚úì
   PostgreSQL: 15.3 ‚úì
   Redis: 7.0.11 ‚úì

‚úÖ Project Setup
   Repository: ‚úì On main branch
   Dependencies: ‚úì 1,247 packages installed
   Environment: ‚úì .env.local configured
   Database: ‚úì Connected to project_dev

‚úÖ Services
   API Server: ‚úì http://localhost:3000/api/health
   Frontend: ‚úì http://localhost:3000
   Database: ‚úì 45 tables, 10,000 seed records
   Redis: ‚úì Connected, 0 keys

‚úÖ Development Tools
   VS Code: ‚úì With 5 extensions
   Husky: ‚úì pre-commit, commit-msg hooks
   Linting: ‚úì ESLint + Prettier configured
   Nodemon: ‚úì Auto-restart enabled
   Testing: ‚úì 245 tests passing
   Claude: ‚úì Permissions configured

üéâ Environment ready! Run 'npm run dev' to start developing.
```

## Common Issues & Solutions

```markdown
## üîß Troubleshooting

### Port Already in Use
```bash
# Find process using port 3000
lsof -i :3000
# Kill the process
kill -9 <PID>
```

### Database Connection Failed
```bash
# Check PostgreSQL is running
brew services list
# Start PostgreSQL
brew services start postgresql
```

### Permission Denied
```bash
# Fix npm permissions (without sudo)
chown -R $(whoami) ~/.npm

### WSL-Specific Issues
```bash
# If running on Windows/WSL
# Check WSL version
wsl -l -v
# Should be version 2
```

### Module Not Found
```bash
# Clear cache and reinstall
rm -rf node_modules package-lock.json
npm cache clean --force
npm install
```
```

## Options
- `--check` - Verify setup without making changes
- `--minimal` - Skip optional components
- `--docker` - Use Docker-based setup
- `--ci` - Setup for CI environment

## Integration Points
- Creates initial GitHub issues for onboarding
- Sets up git hooks for commit standards
- Configures IDE for project conventions
- Initializes monitoring and logging
- Prepares for first `/implement` command

## Next Steps After Setup

```markdown
## üöÄ Ready to Code!

### 1. Start Development Server
npm run dev  # Runs both frontend and backend with nodemon

### 2. View Documentation
npm run docs

### 3. Run Tests
npm test

### 4. Create Your First Feature
/add-feature "My first feature"
/plan "My first feature"
/implement 1

### 5. Useful Commands
- npm run lint - Check code style
- npm run test:watch - Test in watch mode
- npm run db:studio - Database GUI
- npm run storybook - Component library

### 6. Get Help
- README.md - Project overview
- docs/ - Detailed documentation
- /help - Command help
- Team Slack: #dev-help
```